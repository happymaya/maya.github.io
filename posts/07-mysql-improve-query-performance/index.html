<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="怎么提高查询性能" /><meta name="author" content="superhsc" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="ThinkerWalker, happymaya, superhsc, maya, imaya, thinkerwalker, 清锋, haoshichuan." /><meta property="og:description" content="ThinkerWalker, happymaya, superhsc, maya, imaya, thinkerwalker, 清锋, haoshichuan." /><link rel="canonical" href="/posts/07-mysql-improve-query-performance/" /><meta property="og:url" content="/posts/07-mysql-improve-query-performance/" /><meta property="og:site_name" content="ThinkerWalker" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-12T02:53:22+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="怎么提高查询性能" /><meta name="twitter:site" content="@happymaya" /><meta name="twitter:creator" content="@superhsc" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"superhsc"},"dateModified":"2020-07-12T02:53:22+00:00","datePublished":"2020-07-12T02:53:22+00:00","description":"ThinkerWalker, happymaya, superhsc, maya, imaya, thinkerwalker, 清锋, haoshichuan.","headline":"怎么提高查询性能","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/07-mysql-improve-query-performance/"},"url":"/posts/07-mysql-improve-query-performance/"}</script><title>怎么提高查询性能 | ThinkerWalker</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ThinkerWalker"><meta name="application-name" content="ThinkerWalker"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://images.happymaya.cn/assert/avatar/logo.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ThinkerWalker</a></div><div class="site-subtitle font-italic">日拱一卒 功不唐捐</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/happymaya" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/happymaya" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['haoshichuan','foxmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>怎么提高查询性能</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>怎么提高查询性能</h1><div class="post-meta text-muted"><div> 作者 <em> <a href="https://github.com/happymaya">superhsc</a> </em></div><div class="d-flex"><div> <span> 发表于 <em class="timeago" data-ts="1594522402" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2020-07-12 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5650 字"> <em>31 分钟</em>阅读</span></div></div></div><div class="post-content"><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0701.png" alt="" data-proofer-ignore></p><h2 id="mysql-查询优化器"><span class="mr-2">MySQL 查询优化器</span><a href="#mysql-查询优化器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="select-执行过程"><span class="mr-2">SELECT 执行过程</span><a href="#select-执行过程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>查询优化器处理 SQL 的全过程。以 SELECT 的 SQL 的执行过程为例，如下图所示：</p><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0702.png" alt="" data-proofer-ignore></p><ol><li>客户端发送一条 SELECT 查询给服务器；<li>服务器先检查查询缓存，如果命中缓存，则立刻返回存储在缓存中的结果。否则进入下一阶段；<li>服务器进行 SQL 解析、预处理、再由查询优化器生成对应的执行计划；<li>MySQL 根据优化器生成的执行计划，调用存储引擎的 API 来执行查询；<li>将结果返回给客户端，同时也会放入查询缓存中。</ol><h3 id="优化栗子"><span class="mr-2">优化栗子</span><a href="#优化栗子" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>MySQL 查询优化器并不是那么完美！！！</p><p>MySQL 采用基于开销的优化器，以确定处理查询的最佳方式，也就是说执行查询之前，都会先选择一条自以为最优的方案。</p><p>在很多情况下，MySQL 能够计算最佳的可能查询计划，但在某些情况下，MySQL 没有关于数据的足够信息，或者是提供太多的相关数据信息，它所采用的可能并非就是事实上的最优方案。</p><p>两个例子来说明。</p><h4 id="案例一为什么-range-执行效率差-"><span class="mr-2">案例一：为什么 Range 执行效率差 ？</span><a href="#案例一为什么-range-执行效率差-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Range 类查询的执行计划流程：</p><ol><li>根据查询条件计算所有的 possible keys；<li>计算全表扫描代价（cost_all）；<li>计算最小的索引范围访问代价（这一步很关键，直接决定了 Range 的查询效率），它有三步：<ol><li>对于每一个 possible keys（可选索引），调用 records_in_ranges 函数计算范围中的rows；<li>根据 rows，计算二级索引访问代价；<li>获取 cost 最小的二级索引访问代价（cost_range）。</ol><li>选择执行最小化访问代价的执行计划。如果 cost_all &lt;= cost_range，则全表扫描，否则索引范围扫描。</ol><p>对于这个例子：</p><ul><li>Range 使用了 records_in_range 函数估算每个值范围的 rows，结果依赖于possible_keys；<li>possible_keys 越多，随机 IO 代价越大，Range 查询效率越差。</ul><p>所以，索引不是越多越好，相反，应该尽量减少 possible_keys，减少 records_in_range 从而减少 IO 的消耗。</p><p>有两个工具：</p><ul><li>用 pt-index-usage 工具来删除冗余索引；<li>用 pt-duplicate-key-checker 工具来删除重复索引。</ul><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0703.png" alt="" data-proofer-ignore></p><h4 id="案例二"><span class="mr-2">案例二</span><a href="#案例二" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>这样的一个表结构（优化后的），优化前有一个索引 idx_global_id。图中的这条 SQL 语句的 where 条件包括一个 sub_id 的等值查询和一个 global_id 的范围查询。执行一次需要 2.37 秒。从下一页的执行计划中，我们可以看到虽然查询优化器使用了唯一索引 uniq_subid_globalid，但是由于 idx_global_id 的干扰，实际只使用了前面的 4 个长度就 access，剩余 8 个长度都被 filter 了。</p><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0704.png" alt="" data-proofer-ignore></p><p>从优化后的执行计划中可以看到，使用了 force index 来强制使用唯一索引。正如上文列举的，相似的命令还有 ignore index 忽略索引，straght_join 强制优化器按特定的顺序使用数据表，high_priority 或 low_priority 两个命令来控制 SQL 的执行优先权。</p><h3 id="icp什么是-mrr什么是-bka"><span class="mr-2">ICP？什么是 MRR？什么是 BKA？</span><a href="#icp什么是-mrr什么是-bka" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="icp"><span class="mr-2">ICP</span><a href="#icp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>ICP 是 Index Condition Pushdown 的简称，是 MySQL 使用索引从表中检索行数据的一种优化方式。</p><p>目的是减少从基表中全记录读取操作的数量，从而降低 IO 操作。</p><p>在没有开启 ICP 之前，存储引擎会通过遍历索引查找基表中的行，然后返回给 MySQL Server 层，再去为这些数据行进行 where 后的条件过滤。</p><p>开启 ICP 之后，如果部分 where 条件能使用索引中的字段，MySQL Server 会把这部分下推到存储引擎层，存储引擎通过索引过滤，把满足的行从表中读取出来。</p><p>ICP 能减少引擎层访问基表的次数和 MySQL Server 访问存储引擎的次数。对于 InnoDB 表来说，ICP 只适用于辅助索引。</p><h4 id="mrr"><span class="mr-2">MRR</span><a href="#mrr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>MRR 是 Multi-Range Read 的简称，是 MySQL 优化器将随机 IO转化为顺序 IO 以降低查询过程中 IO 开销的一种手段。</p><p>MRR 的适用场景是辅助索引，如 INDEX(key1)，查询 key1 在 n 到 m 范围内的数据。使用限制就是 MRR，MRR 适用于 range、ref、eq_ref 的查询。</p><h4 id="bka-和-bnl"><span class="mr-2">BKA 和 BNL</span><a href="#bka-和-bnl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>BKA 是 Batched Key Access 的简称，是 MySQL 优化器提高表 join 性能的一种手段，它是一种算法。而 BNL 是 Block Nested Loop 的简称，它是默认的处理表 join 的方式和算法。</p><p>二者有的区别：</p><p>• BNL 比 BKA 出现的早，BKA 直到 MySQL 5.6 版本才出现，而 BNL 至少在 MySQL 5.1 版本中就存在了；</p><p>• BNL 主要用于被 join 的表上无索引时；</p><p>• BKA 只在被 join 表上有索引时可以使用，那么就在行提交给被 join 的表之前，对这些行按照索引字段进行排序，因此减少了随机 IO，排序才是两者最大的区别，但如果被 join 的表没有索引呢？那么就只能使用 BNL 了。</p><p>使用 BKA 需要注意一些问题，比如：</p><ul><li><p>BKA 的适用场景支持 inner join、outer join、semi-join operations、including nested outer joins 等；</p><li><p>BKA 有两个使用限制：</p><ul><li>一个是使用 BKA 特性，必须启用 MRR 特性；<li>二是 BKA 主要适用于 join 的表上有索引可使用的情况，否则只能使用 BNL。</ul></ul><h2 id="mysql-执行计划分析三步曲"><span class="mr-2">MySQL 执行计划分析“三步曲”</span><a href="#mysql-执行计划分析三步曲" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>MySQL 的查询优化器有时候也会“犯糊涂”，当有慢查询或者执行 SQL 遇到瓶颈时，分析这类问题时可以参考 MySQL 执行计划分析“三步曲”。</p><ol><li>查看 SQL 执行计划<ul><li>explain SQL；<li>desc 表名；<li>show create table 表名。</ul><li>通过 Profile 定位 QUERY 代价消耗<ul><li>set profiling=1；<li>执行 SQL；<li>show profiles; 获取 Query_ID；<li>show profile for query Query_ID，查看详细的 profile 信息。</ul><li>通过 Profile 定位 QUERY 代价消耗<ul><li>set session optimizer_trace=’enabled=on’；<li>执行 SQL；<li>查询 information_schema.optimizer_trace 表，获取 SQL 查询计划树；<li>set session optimizer_trace=‘enabled=off’，==<strong>开启此项影响性能，记得用后关闭</strong>==</ul></ol><h2 id="mysql-执行计划查询分析"><span class="mr-2">MySQL 执行计划查询分析</span><a href="#mysql-执行计划查询分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>对于 MySQL 的慢查询，相关参数和分析工具。</p><h3 id="相关参数"><span class="mr-2">相关参数</span><a href="#相关参数" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>MySQL 可以通过设置一些参数，将运行时间长或者非索引查找的 SQL 记录到慢查询文件中。</p><p>可以分析慢查询文件中的 SQL，有针对性的进行优化：</p><ul><li><p>参数 slow_query_log，表示是否开启慢查询日志，ON 或者 1 表示开启，OFF 或者 0 表示关闭；</p><li>参数 long_query_time，设置慢查询的阈值，MySQL 5.7 版本支持微秒级；<li>参数 slow_query_log_file，慢查询文件的存放路径；<li>参数 log_queries_not_using_indexes，表示是否将非索引查找的 SQL 也记录到慢查询文件中；<li>参数 log_throttle_queries_not_using_indexes，表示每分钟记录到慢查询文件中未使用索引的 SQL 语句上限，0 表示没限制；<li>参数 max_execution_time，用来控制 SELECT 语句的最大执行时间，单位毫秒，超过此值MySQL 自动 kill 掉该查询。</ul><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0705.png" alt="" data-proofer-ignore></p><p>如上图所示，是一个慢查询的例子，通过这个例子可以看到慢查询文件中记录了哪些信息。包括：</p><ul><li>慢 SQL 产生的时间，SQL 源自的 IP 和对应的数据库用户名，以及访问的数据库名称；<li>查询的总耗时，被 lock 的时间，结果集行数，扫描的行数，以及字节数等，还有具体的 SQL 语句。</ul><h3 id="分析工具"><span class="mr-2">分析工具</span><a href="#分析工具" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p>explain；</p><li><p>Mysqldumpslow，官方慢查询分析工具；</p><li>pt-query-digest，Percona 公司开源的慢查询分析工具，它是用于分析 MySQL 慢查询的一个常用工具：<ul><li>先对查询语句的条件进行参数化；<li>然后对参数化以后的查询进行分组统计，统计出各查询的执行时间、次数、占比等；<li>同时把分析结果输出到文件中；<li>也可以结合 Anemometer 工具将慢查询平台化展示。</ul><li><p>vc-mysql-sniffer，第三方的慢查询抓取工具；</p><li>pt-kill，Percona 公司开源的慢查询 kill 工具，常用于生产环境的过载保护。</ul><p>社区还开源了许多优秀的慢查询优化工具或系统，如：Inception、SQLAdvisor 和 Soar 等，</p><h2 id="优化-sql-规则"><span class="mr-2">优化 SQL 规则</span><a href="#优化-sql-规则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>SQL 设计和优化需要考虑的几个方面：</p><ol><li><p>全表扫描还是索引扫描。对于小表来说，二者 IO 调用次数和返回时间相差不大；但对于大表，如果全表扫描，那么查询返回的时间就会很长，就需要使用索引扫描加快查询速度。但并不是要求 DBA 根据每一种查询条件组合都要创建索引，索引过多也会降低写入和修改的速度，而且如果导致表数据和索引数据比例失调，也不利于后期的正常维护；</p><li><p>如何创建索引，在哪些列上建立索引适合业务需求？一般情况下，你可以在选择度高的列上创建索引，也可以在 status 列上创建索引。创建索引时，要注意避免冗余索引，除非一些特殊情况外。如 index(a,b,c) 和 index(a)，其中 a 的单列索引就是冗余索引；</p><li><p>创建索引以后，尽量不要过频修改。业务可以根据现有的索引情况合理使用索引，而不是每次都去修改索引。能在索引中完成的查找，就不要回表查询。比如 SELECT 某个具体字段，就有助于实现覆盖索引从而降低 IO 次数，达到优化 SQL 的目的。</p><li><p>多表关联的 SQL，在关联列上要有索引且字段类型一致，这样 MySQL 在进行嵌套循环连接查找时可以使用索引，且不会因为字段类型不匹配，而发生隐式转换进而导致无法使用索引的情况发生。</p><p>在现实情况中，经常会出现 SQL 中关联列字段类型不一致或者传入的参数类型与字段类型不匹配的情况，这样就会导致无法使用索引，在优化 SQL 时需要重点排查这种情况。</p><p>另外索引列上使用函数也不会涉及索引。</p><p>多表关联时，尽量让结果集小的表作为驱动表，注意是结果集小的表，不是小表。</p><li><p>在日常中发现全模糊匹配的查询，由于 MySQL 的索引是 B+ 树结构，所以当查询条件为全模糊时，例如‘%**%’，索引无法使用，这时需要通过添加其他选择度高的列或者条件作为一种补充，从而加快查询速度。</p><p>当然也可以通过强制 SQL 进行全索引扫描，但这种方式不好，尽量不要在 SQL 中添加 hints。对于这种全模糊匹配的场景，可以放到 ES 或者 solr 中解决。</p><p>尽量不要使用子查询，对子查询产生的临时表再扫描时将无索引可查询，只能进行全表扫描，并且 MySQL 对于出现在 from 中的表无所谓顺序，对于 where 中也无所谓顺序，这也是可以优化 SQL 的地方。</p><li><p>另外 order by/group by 的 SQL 涉及排序，尽量在索引中包含排序字段，并让排序字段的排序顺序与索引列中的顺序相同，这样可以避免排序或减少排序次数。</p><li><p>复杂查询还是简单查询？貌似总会面临这样的疑问和选择。不要总想着用一个SQL 解决所有事情，可以分步骤来进行，MySQL 也十分擅长处理短而简单的 SQL，总体耗时会更短，而且也不会产生臃肿的 SQL，让人难以理解和优化。</p></ol><h2 id="mysql-自身优化-sql"><span class="mr-2">MySQL 自身优化 SQL</span><a href="#mysql-自身优化-sql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>MySQL 自身也对 SQL 自动进行了优化处理。</p><p>MySQL 能够处理的优化类型有下面这些。</p><ol><li>重新定义表的关联顺序。多表关联查询时，MySQL 日益强大的优化器会自动选择驱动表，以及表的连接顺序，基于 cost 规则极大减少 SQL 执行的时间；<li>使用等价变化规则。MySQL 可以合并或减少一些比较，还可以移除一些恒成立或恒不成立的判断；<li>优化 count()、min() 和 max()。索引和列是否可为空通常可以帮助 MySQL 优化这类表达式，如查找最小值只需找到索引树最左边的第一条记录即可。</ol><h2 id="常用的-sql-编写规范"><span class="mr-2">常用的 SQL 编写规范</span><a href="#常用的-sql-编写规范" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>如下所示：</p><ul><li>SELECT 只获取必要的字段，禁止使用 SELECT *。这样能减少网络带宽消耗，有效利用覆盖索引，表结构变更对程序基本无影响；<li>用 IN 代替 OR。SQL 语句中 IN 包含的值不宜过多，应少于 1000 个。过多会使随机 IO 增大，影响性能。<li>禁止使用 order by rand()。order by rand() 会为表增加几个伪列，然后用 rand() 函数为每一行数据计算 rand() 值，最后基于该行排序，这通常都会生成磁盘上的临时表，因此效率非常低。建议先使用 rand() 函数获得随机的主键值，然后通过主键获取数据；<li>SQL 中避免出现 now()、rand()、sysdate()、current_user() 等不确定结果的函数。在语句级复制场景下，引起主从数据不一致；不确定值的函数，产生的 SQL 语句无法使用 QUERY CACHE；<li>重要 SQL 必须被索引：update、delete 的 where 条件列、order by、group by、distinct 字段、多表 join 字段；<li>禁止使用 % 前导查询，例如：like “%abc”，⽆法利⽤到索引；<li>禁止使⽤负向查询，例如：not in、!=、&lt;&gt;、not like；<li>使⽤ EXPLAIN 判断 SQL 语句是否合理使用索引，尽量避免 extra 列出现：Using File Sort、Using Temporary 等；<li>减少与数据库交互次数，尽量采用批量 SQL 语句；<li>获取⼤量数据时，建议分批次获取数据，每次获取数据少于 5000 条，结果集应⼩于 1M；<li>拆分复杂 SQL 为多个 小SQL，避免⼤事务。简单的 SQL 容易使用到 MySQL 的 QUERY CACHE；减少锁表时间特别是 MyISAM；可以使用多核 CPU。</ul><h2 id="栗子"><span class="mr-2">栗子</span><a href="#栗子" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="根据-extra-列优化"><span class="mr-2">根据 Extra 列优化</span><a href="#根据-extra-列优化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>根据 Extra 列的输出内容进行优化的案例，如下图所示。</p><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0706.png" alt="" data-proofer-ignore></p><p>优化方法就是创建索引，避免排序和临时表的开销。</p><h3 id="根据-rows-列优化"><span class="mr-2">根据 ROWS 列优化</span><a href="#根据-rows-列优化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>如下图：</p><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0707.png" alt="" data-proofer-ignore>优化前的 SQL 执行计划中 ROWS 是 181899 行，耗时 0.51 秒。</p><p>咋一看来，还挺满意的，但是放在具体的业务场景中，尤其是业务并发量大，机器性能一般的情况下，业务高峰期是一个巨大的坑，随着业务并发量的增长，性能呈现急剧恶化，这种情况依然需要优化。</p><p>通过添加 endtime 索引来达到优化效果的，优化后，执行计划中的 ROWS 变成了 134 行，基本上是“秒回”。</p><p>优化后效果见下图：</p><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0708.png" alt="" data-proofer-ignore></p><p>这个案例中使用的优化思路是：<strong>结合业务模式和数据分布来优化具体的 SQL 语句；</strong>重点分析 ROWS 列的输出，对各查询条件扫描行数进行对比，找出最优的索引策略。</p><h3 id="group-by-和-order-by-的优化"><span class="mr-2">group by 和 order by 的优化</span><a href="#group-by-和-order-by-的优化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>优化方式见上文【SQL 规则】</p><ul><li>GROUP BY 实质为排序和去重（distinct）的组合，通常它会结合一些聚合函数如 sum、count、avg、max、min 等来使用，根据一个或多个列对结果集进行分组，查看执行计划中的 Extra 列的输出内容，可以看到有 Using temporary; Using filesort。<li>ORDER BY 对结果集进行排序时，查看执行计划中的 Extra 列的输出内容，也可以看到有 Using temporary; Using filesort。</ul><p>分组和排序都涉及排序，故尽量在索引中包含排序字段，并让排序字段的排序顺序与索引列中的顺序相同，这样可以避免排序或减少排序次数。比如 <code class="language-plaintext highlighter-rouge">where a=? order by b,c</code>，就可以创建一个索引 (a,b,c)。如果执行计划中出现 using filesort，这时就要重点关注索引字段和顺序了。</p><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0709.png" alt="" data-proofer-ignore></p><h3 id="limit-分页优化"><span class="mr-2">Limit 分页优化</span><a href="#limit-分页优化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>对于分页问题，经常会被问到的问题，SQL 语句如下：</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">TABLE</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">col2</span> <span class="k">limit</span> <span class="mi">80000</span><span class="p">,</span><span class="mi">20</span><span class="p">;</span>
</pre></table></code></div></div><p>Limit 有 start、offset 两个值，分页 SQL 的耗时随着 start 的增大而增加。</p><p>原始分页查询的耗时是 2.87 秒，然后用子查询和表连接两种方式进行 SQL 改写后，查询的耗时都只有 0.5 秒左右。</p><p>优化思路就是：</p><ul><li>SQL 尽量走索引，避免排序，减少不必要的物理 IO；<li>每页展示数据确定起始范围，取符合条件取 N 条记录即可；<li>由于传递的是主键（具有唯一特性），可以快速定位，获取数据。</ul><h3 id="count-优化"><span class="mr-2">count 优化</span><a href="#count-优化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>下面的四条 SELECT 语句：</p><ul><li>select count(*) from table … ;<li>select count(1) from table … ;<li>select count(primary key) from table … ;<li>select count(index key) from table …;</ul><p>哪个执行效率最高呢？这个问题需要具体问题具体分析，不能一概而论。</p><p>以 SELECT count(1) 这条 SQL 为例：</p><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0710.png" alt="" data-proofer-ignore></p><p>优化前和优化后，执行效率相差 2 倍。就添加了一个索引。</p><p>优化思路是：</p><ul><li>选择索引 key_len 最短的二级索引效率高，不要使用全表扫描（PK 聚族索引会全表扫描），因为索引 key_len 越短，读取页面越少，进而 IO_COST 越小。</ul><h3 id="bad-sql-案例"><span class="mr-2">Bad SQL 案例</span><a href="#bad-sql-案例" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>下面是一些 Bad SQL 的栗子，如下图所示:</p><p><img data-src="https://images.happymaya.cn/assert/db/mysql/mysql-0711.png" alt="" data-proofer-ignore></p><div class="table-wrapper"><table><thead><tr><th>SQL<th>影响<tbody><tr><td>select/update/delete 语句中没有 where 或者 where 中没有索引字段<td>会造成全表扫描，update 和 delete 语句还会加表级锁，阻塞其他并发的 SQL<tr><td>delete from table<td>删除全表数据。delete 会产生大量 undo 和 redo ，执行时间很长，可用 truncate table 来代替<tr><td>select from table where col_vchar=123<td>产生隐式转换，col_vchar 字段上默认会加一个to_number的函数，无法使用索引，全<br />表扫描<tr><td>select from table where DATE(ctime)=curdate()<td>索引字段上有显式函数，无法使用索引，全表扫描<tr><td>select from like ‘%**%‘<td>全模糊匹配<tr><td>select from tabl,tab2 where tab1.col_int=col_vchar<td>两个表关联查询，关联列的字段类型不匹配，一个varchar，一个int，无法使用索引<tr><td>col_utf8mb4=col_utf8<td>关联列类型都是 varchar, 但字符集不同，无法使用索引</table></div><ul><li>select/update/delete 语句中没有 where 或者 where 中无索引字段，这样的 SQL 都没有使用索引，会造成全表扫描，update 和 delete 语句还会加表级锁，阻塞其他并发的 SQL；<li>select from table where col_vchar=123，这个 SQL 产生了隐式转换，col_vchar 字段是一个 varchar 类型，但传入的值却是数字类型，这样 col_vchar 字段上会默认加一个 to_number 的函数，无法使用索引，全表扫描，你需要重点注意一下这样看着简单但很容易被忽略的 SQL ；<li>col_utf8mb4=col_utf8，大家要注意这种情况，尽量两个表的关联列类型都是 varchar，但字符集不相同，同样无法使用索引，你在日常优化 SQL 和设计表结构时一定要注意，尽量采用 utf8mb4 为默认字符集，如果两个表字符集不同，则需要提前变更一下。</ul><p>实际业务中优化数据库访问要做到以下几点：</p><ol><li>DBA 要参与重⼤项⽬的数据库⽅案选型和设计，以及审核数据库表结构和 SQL 语句；<li>DBA 设计批量导入/导出数据的方案并监控过程和影响；<li>大量的更新/删除操作控制频度，例如每秒操作 2000 行以下；<li>对于后台管理或者其他统计类的只读场景，可以做读写分离，利用从库分担写库的读压力；<li>使⽤ prepared statement 和绑定变量，可以提升性能并避免 SQL 注入；<li>程序应有捕获 SQL 异常的处理机制，必要时通过rollback显式回滚。<li>尽量少使用 distinct、order by、group by、union 等 SQL，排序需求可以放到前端；<li>大事务或者长查询的需求根据业务特点拆分；<li>杜绝程序中在处理事务时夹杂 RPC，会造成资源长时间不释放。有很多锁超时、并发数上涨都是由于事务中有 RPC 造成的；<li>关注软件本身的优化同时，也需要关注硬件的性能指标和优化，以及硬件的发展方向。MySQL 属于 IO 密集型的应用，对存储硬件的 IO 性能要求比较高，在高并发的场景中，建议使用 PCI-e。</ol><h2 id="应用层性能优化"><span class="mr-2">应用层性能优化</span><a href="#应用层性能优化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>除了对 MySQL 优化外，有很多时候，MySQL优化已经到了极致，需要站在更高的角度来进行“上层建筑”的规划和设计，比如要知道常用的缓存技术 Memcached、Redis、Codis、Pika、Aerospike 等，还需要知道常用的消息队列 Kafka、RabbitMQ、Redis Stream 数据结构等，还需要了解常用的全文索引工具 Elasticsearch、Solr、sphinx 等，大数据系统 HBase、Spark、Druid 等等。</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/database/'>Database</a>, <a href='/categories/mysql/'>MySQL</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mysql/" class="post-tag no-text-decoration" >MySQL</a> <a href="/tags/index-design/" class="post-tag no-text-decoration" >Index Design</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=怎么提高查询性能 - ThinkerWalker&amp;url=/posts/07-mysql-improve-query-performance/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=怎么提高查询性能 - ThinkerWalker&amp;u=/posts/07-mysql-improve-query-performance/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=/posts/07-mysql-improve-query-performance/&amp;text=怎么提高查询性能 - ThinkerWalker" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/use-spring-security-to-build-a-user-authentication-system/">Spring Security 的配置体系</a><li><a href="/posts/spring-data-jpa-test/">利用单元测试和集成测试</a><li><a href="/posts/query-annotation/">Spring Data JPA - @Query</a><li><a href="/posts/defining-query-methods/">Spring Data JPA - Defining Query Methods 的命名语法与参数</a><li><a href="/posts/cache-redis-02/">Redis 的数据类型</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/jvm/">JVM</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a> <a class="post-tag" href="/tags/architecture-design/">Architecture Design</a> <a class="post-tag" href="/tags/backend-system/">Backend System</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/spring-security/">Spring Security</a> <a class="post-tag" href="/tags/springboot/">SpringBoot</a> <a class="post-tag" href="/tags/cache/">Cache</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/06-mysql-index-desgin/"><div class="card-body"> <em class="timeago small" data-ts="1594461202" > 2020-07-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>索引设计</h3><div class="text-muted small"><p> 索引的定义 数据库索引是一种数据结构，以额外写入和存储空间为代价来提高数据库表上数据检索操作的速度。 通俗来说，索引类似于书的目录，根据其中记录的页码可以快速找到所需的内容。 ——《维基百科》 MySQL 官方对索引（Index）的定义是存储引擎用于快速查找记录的一种数据结构： 索引是物理数据页，数据库页大小（Page Size）决定了一个页可以存储多少个索引...</p></div></div></a></div><div class="card"> <a href="/posts/01-mysql-system/"><div class="card-body"> <em class="timeago small" data-ts="1593826402" > 2020-07-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MySQL 体系结构</h3><div class="text-muted small"><p> MySQL 数据库的体系结构，如下图所示： 通过上图，MySQL 体系结构由 Client Connectors 层、MySQL Server 层及存储引擎层组成。 Client Connectors 层 负责处理客户端的连接请求，与客户端创建连接。 目前 MySQL 几乎支持所有的连接类型，例如常见的 JDBC、Python、Go 等。 MySQL Server 层 MyS...</p></div></div></a></div><div class="card"> <a href="/posts/02-mysql-storage-engine/"><div class="card-body"> <em class="timeago small" data-ts="1593831202" > 2020-07-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MySQL 存储引擎</h3><div class="text-muted small"><p> 存储引擎是 MySQL 中具体与文件打交道的子系统。 是根据 MySQL AB 公司提供的文件访问层抽象接口定制的一种文件访问机制，这种机制就叫作存储引擎。 常用的存储引擎： 远古时期的 MyISAM； 支持事务的 InnoDB； 内存类型的 Memory； 归档类型的 Archive； 列式存储的 Infobright； 一些新兴的存储引擎： ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/06-mysql-index-desgin/" class="btn btn-outline-primary" prompt="上一篇"><p>索引设计</p></a> <a href="/posts/docker-installation/" class="btn btn-outline-primary" prompt="下一篇"><p>Docker 的安装（01）</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/happymaya">superhsc</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/jvm/">JVM</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a> <a class="post-tag" href="/tags/architecture-design/">Architecture Design</a> <a class="post-tag" href="/tags/backend-system/">Backend System</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/spring-security/">Spring Security</a> <a class="post-tag" href="/tags/springboot/">SpringBoot</a> <a class="post-tag" href="/tags/cache/">Cache</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
