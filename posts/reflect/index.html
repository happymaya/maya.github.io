<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="反射" /><meta name="author" content="superhsc" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="利用 Java 中的一些特性，包括反射、注解、动态代理、类加载器等，可以优雅地实现一些灵活通用的功能，它们经常用于各种框架、库以及系统程序中。" /><meta property="og:description" content="利用 Java 中的一些特性，包括反射、注解、动态代理、类加载器等，可以优雅地实现一些灵活通用的功能，它们经常用于各种框架、库以及系统程序中。" /><link rel="canonical" href="/posts/reflect/" /><meta property="og:url" content="/posts/reflect/" /><meta property="og:site_name" content="ThinkerWalker" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-09-14T03:34:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="反射" /><meta name="twitter:site" content="@happymaya" /><meta name="twitter:creator" content="@superhsc" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"superhsc"},"dateModified":"2022-06-05T19:48:36+00:00","datePublished":"2018-09-14T03:34:00+00:00","description":"利用 Java 中的一些特性，包括反射、注解、动态代理、类加载器等，可以优雅地实现一些灵活通用的功能，它们经常用于各种框架、库以及系统程序中。","headline":"反射","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/reflect/"},"url":"/posts/reflect/"}</script><title>反射 | ThinkerWalker</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ThinkerWalker"><meta name="application-name" content="ThinkerWalker"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://images.happymaya.cn/assert/avatar/logo.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ThinkerWalker</a></div><div class="site-subtitle font-italic">日拱一卒 功不唐捐</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/happymaya" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/happymaya" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['haoshichuan','foxmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>反射</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>反射</h1><div class="post-meta text-muted"><div> 作者 <em> <a href="https://github.com/happymaya">superhsc</a> </em></div><div class="d-flex"><div> <span> 发表于 <em class="timeago" data-ts="1536896040" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2018-09-14 </em> </span> <span> 更新于 <em class="timeago" data-ts="1654458516" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-06 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4845 字"> <em>26 分钟</em>阅读</span></div></div></div><div class="post-content"><p>利用 Java 中的一些特性，包括反射、注解、动态代理、类加载器等，可以优雅地实现一些灵活通用的功能，它们经常用于各种框架、库以及系统程序中。</p><ol><li>例如 Jackson，利用反射和注解实现了通用的序列化机制；<li>Spring MVC、Jersey 用于处理 Web 请求，利用反射和注解，可以方便地将用户的请求参数和内容转换为 Java 对象，将 Java 对象转变为响应内容；<li>Spring、Guice 利用这些特性实现对象管理器，方便管理对象的生命周期以及其中复杂的依赖关系；<li>应用服务器，比如 Tomcat，利用类加载器实现不同应用之间的隔离，JSP 技术利用类加载器实现修改代码而不用重启就能生效的特性；<li>面向切面编程（AOP，Aspect Oriented Programming）将编程中通用的关注点（如日志记录、异常处理、安全检查等）与业务的主体逻辑分离，减少冗余代码，提高代码可维护性，AOP 需要依赖上面的这些特性来是实现。</ol><p>在操作数据的时候，依赖于数据类型，如：</p><ol><li>根据类型，使用 new 创建对象；<li>根据类型定义变量，类型可能是基本类型、类、接口或数组；<li>将特定类型的对象传递给方法；<li>根据类型访问对象的属性，调用对象的方法<li>编译器也是根据类型进行代码的检查编译</ol><p><strong>反射不一样，它是在运行的时候，而不是在编译的时候，动态获取类型的信息，比如接口信息、成员信息、方法信息、构造方法信息等，根据这些动态获取到的信息创建对象，访问/修改成员、调用方法等。</strong></p><h2 id="class-类"><span class="mr-2">Class 类</span><a href="#class-类" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>每一个以及加载的类在内存都有一个份类信息，每个对象都有指向它所属类信息的引用。</p><p>在 Java 中，类信息对应的类就是 java.lang.Class。</p><p>所有类的根父类 Object 有一个方法，可以获取对象的 Class 对象：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>public final native Class&lt;?&gt; getClass();
</pre></table></code></div></div><p>Class 是一个泛型类，有一个类型参数，getClass() 并不知道具体的类型，因此返回 Class&lt;?&gt;。</p><ul><li><p>获取 Class 对象不一定需要实例对象，如果在写代码的时候知道类名，可以使用 <code class="language-plaintext highlighter-rouge">&lt;类名&gt;.class</code> 获取 Class 对象，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Date</span><span class="o">&gt;</span> <span class="n">dateClass</span> <span class="o">=</span> <span class="nc">Date</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</pre></table></code></div></div><li><p>同样，接口也有 Class 对象，并且这种方式对于接口也是适用的，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Comparable</span><span class="o">&gt;</span> <span class="n">comparableClass</span> <span class="o">=</span> <span class="nc">Comparable</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</pre></table></code></div></div><li><p>基本类型没有 getClass 方法，但也都有对应的 Class 对象，类型参数为对应的包装类型，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">integerClass</span> <span class="o">=</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
<span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Byte</span><span class="o">&gt;</span> <span class="n">byteClass</span> <span class="o">=</span> <span class="kt">byte</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
<span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Character</span><span class="o">&gt;</span> <span class="n">characterClass</span> <span class="o">=</span> <span class="kt">char</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
<span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">&gt;</span> <span class="n">doubleClass</span> <span class="o">=</span> <span class="kt">double</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</pre></table></code></div></div><li><p>void 作为特殊的返回类型，也有对应的 Class，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="n">voidClass</span> <span class="o">=</span> <span class="kt">void</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</pre></table></code></div></div><li><p>对于数组，每种类型也都有对应数组类型的 Class 对象，每个维度都有一个，即一维数组有一个，二维数组有一个不同的类型，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nc">String</span><span class="o">[]</span> <span class="n">strArr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[</span><span class="mi">10</span><span class="o">];</span>
<span class="kt">int</span><span class="o">[][]</span> <span class="n">twoDimArr</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">3</span><span class="o">][</span><span class="mi">2</span><span class="o">];</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">oneDimArr</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">10</span><span class="o">];</span>
<span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span>  <span class="nc">String</span><span class="o">[]&gt;</span> <span class="n">strArrClass</span> <span class="o">=</span> <span class="n">strArr</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
<span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span>  <span class="kt">int</span><span class="o">[][]&gt;</span> <span class="n">twoDimArrClass</span> <span class="o">=</span> <span class="n">twoDimArr</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
<span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span>  <span class="kt">int</span><span class="o">[]&gt;</span> <span class="n">oneDimArrClass</span> <span class="o">=</span> <span class="n">oneDimArr</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
</pre></table></code></div></div><li><p>枚举类型也有对应的 Class ，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">enum</span> <span class="nc">Size</span><span class="o">{</span>
	<span class="no">SMALL</span><span class="o">,</span> <span class="no">MEDIUM</span><span class="o">,</span> <span class="no">BIG</span>
<span class="o">}</span>
<span class="nc">Class</span><span class="o">&lt;</span><span class="nc">Size</span><span class="o">&gt;</span> <span class="n">sizeClass</span> <span class="o">=</span> <span class="nc">Size</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</pre></table></code></div></div><li><p>Class 有一个静态方法 forName，可以根据类名直接加载 Class，获取 Class 对象，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">try</span> <span class="o">{</span>
    <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"java.util.HashMap"</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cls</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div></ul><p>有了 Class 对象之后，就可以了解到关于类型的很多信息，并可以基于这些信息采取一些行动。</p><p>Class 方法有很多，大体包括：<strong>名称信息</strong>、<strong>字段信息</strong>、<strong>方法信息</strong>、<strong>创建对象和构造函数</strong>、<strong>类型信息</strong>等。</p><h3 id="名称信息"><span class="mr-2">名称信息</span><a href="#名称信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{}</span>				<span class="c1">// 返回的名称不带包信息</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getSimpleName</span><span class="o">()</span> <span class="o">{}</span>		<span class="c1">// 返回的是 Java 内部使用的真正的名称</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getCanonicalName</span><span class="o">()</span> <span class="o">{}</span>		<span class="c1">// 返回的更好</span>
<span class="kd">public</span> <span class="nc">Package</span> <span class="nf">getPackage</span><span class="o">()</span> <span class="o">{}</span>			<span class="c1">// 返回的是包信息</span>
</pre></table></code></div></div><p>它们的不同具体如下：</p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Class 对象<th style="text-align: center">getName<th style="text-align: center">getSimpleName<th style="text-align: center">getCanonicalName<th style="text-align: center">getPackage<tbody><tr><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int.class</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">null</code><tr><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int[].class</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">[I</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int[]</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int[]</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">null</code><tr><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int[][].class</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">[[I</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int[][]</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">int[][]</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">null</code><tr><td style="text-align: center"><code class="language-plaintext highlighter-rouge">String.class</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.lang.String</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">String</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.lang.String</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.lang</code><tr><td style="text-align: center"><code class="language-plaintext highlighter-rouge">String[][].class</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">[Ljava.lang.String;</code>（注意这里有一个英文分号;）<td style="text-align: center"><code class="language-plaintext highlighter-rouge">String[]</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.lang.String[]</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">null</code><tr><td style="text-align: center"><code class="language-plaintext highlighter-rouge">HashMap.class</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.util.HashMap</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">HashMap</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.util.HashMap</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.util</code><tr><td style="text-align: center"><code class="language-plaintext highlighter-rouge">Map.Entry.class</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.util.Map$Entry</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">Entry</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.util.Map.Entry</code><td style="text-align: center"><code class="language-plaintext highlighter-rouge">java.util</code></table></div><p>需要说明的是数组类型的 getName 返回值，它使用前缀 <code class="language-plaintext highlighter-rouge">[</code>表示数组，有几个<code class="language-plaintext highlighter-rouge">[</code>就表示是几维数组；数组的类型用一个字符表示，I 表示 int，L 表示类或接口，其他类型与字符的对应关系为：</p><ul><li>boolean(Z)<li>byte(B)<li>char(C)<li>double(D)<li>float(F)<li>long(J)<li>short(S)<li>对于引用类型的数组，注意最后有一个分号！！！</ul><h3 id="字段信息"><span class="mr-2">字段信息</span><a href="#字段信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>类中定义的静态和实例变量都称为字段，用类 Filed 表示，位于包 <code class="language-plaintext highlighter-rouge">java.lang.reflect</code>。</p><p>Class 有 4 个获取字段信息的方法，如下：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// 返回所有的 public 字段，包括其父类的，如果没有字段，返回空数组</span>
<span class="kd">public</span> <span class="nc">Field</span><span class="o">[]</span> <span class="nf">getFields</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SecurityException</span> <span class="o">{}</span>
<span class="c1">// 返回本类声明的所有字段，包括非 public 的，但不包括父类的</span>
<span class="kd">public</span> <span class="nc">Field</span><span class="o">[]</span> <span class="nf">getDeclaredFields</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SecurityException</span> <span class="o">{}</span>
<span class="c1">// 返回本类或父类中指定名称的 public 字段，找不到则抛出异常 NoSuchFieldException </span>
<span class="kd">public</span> <span class="nc">Field</span> <span class="nf">getField</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">){}</span>
<span class="c1">// 返回本类中声明的指定名称的字段，找不到则抛出异常 NoSuchFieldException</span>
<span class="kd">public</span> <span class="nc">Field</span><span class="o">[]</span> <span class="nf">getDeclaredFields</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SecurityException</span> <span class="o">{}</span>
</pre></table></code></div></div><p>Field 也有很多方法，可以获取字段的信息，也可以通过 Field 访问和操作指定对象中该字段的值，基本方法有：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>public String getName() {return name;}
</pre></table></code></div></div><p>对于静态变量，obj 被忽略，可以为 null；</p><p>对于基本数据类型，自动在基本类型和对应的包装类型间进行转换；</p><p>对于 private ，直接调用会返回，会抛出非法访问异常 IllegalAccessException，应该先调用 setAccessiable(true) 以关闭 Java 的检查机制，如下：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"刘备"</span><span class="o">,</span><span class="s">"关羽"</span><span class="o">,</span><span class="s">"刘备"</span><span class="o">});</span>
<span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">objClass</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="nc">Field</span> <span class="nl">f:</span> <span class="n">objClass</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">f</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" - "</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">obj</span><span class="o">));</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>除了以上，还有很多其他方法，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">// 返回字段的修饰符，返回的 int，可以通过 Modifiers 类的静态方法进行解读</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getModifiers</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">modifiers</span><span class="o">;</span> <span class="o">}</span>

<span class="c1">// 返回字段的类型</span>
<span class="kd">public</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getType</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">type</span><span class="o">;</span> <span class="o">}</span>

<span class="c1">// 以基本类型操作字段</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBoolean</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">z</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="nc">IllegalArgumentException</span><span class="o">,</span> <span class="nc">IllegalAccessException</span> <span class="o">{}</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">getBoolean</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="nc">IllegalArgumentException</span><span class="o">,</span> <span class="nc">IllegalAccessException</span> <span class="o">{}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDouble</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="kt">double</span> <span class="n">d</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="nc">IllegalArgumentException</span><span class="o">,</span> <span class="nc">IllegalAccessException</span> <span class="o">{}</span>
<span class="kd">public</span> <span class="kt">double</span> <span class="nf">getDouble</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="nc">IllegalArgumentException</span><span class="o">,</span> <span class="nc">IllegalAccessException</span> <span class="o">{}</span>

<span class="c1">// 查询字段的注解信息</span>
<span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Annotation</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">getAnnotation</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">annotationClass</span><span class="o">)</span> <span class="o">{}</span>
<span class="kd">public</span> <span class="nc">Annotation</span><span class="o">[]</span> <span class="nf">getDeclaredAnnotations</span><span class="o">()</span>  <span class="o">{}</span>
</pre></table></code></div></div><p>栗子：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nc">Field</span> <span class="n">f</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nc">Demo</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getField</span><span class="o">(</span><span class="s">"MAX_NAME_LEN"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchFieldException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
<span class="kt">int</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getModifiers</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Modifier</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">mod</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"isPublic: "</span> <span class="o">+</span> <span class="nc">Modifier</span><span class="o">.</span><span class="na">isPublic</span><span class="o">(</span><span class="n">mod</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"isStatic: "</span> <span class="o">+</span> <span class="nc">Modifier</span><span class="o">.</span><span class="na">isStatic</span><span class="o">(</span><span class="n">mod</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"isFinal: "</span> <span class="o">+</span> <span class="nc">Modifier</span><span class="o">.</span><span class="na">isFinal</span><span class="o">(</span><span class="n">mod</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"isVolatile: "</span> <span class="o">+</span> <span class="nc">Modifier</span><span class="o">.</span><span class="na">isVolatile</span><span class="o">(</span><span class="n">mod</span><span class="o">));</span>
</pre></table></code></div></div><p>输出结果：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span>
<span class="nl">isPublic:</span> <span class="kc">true</span>
<span class="nl">isStatic:</span> <span class="kc">true</span>
<span class="nl">isFinal:</span> <span class="kc">true</span>
<span class="nl">isVolatile:</span> <span class="kc">false</span>
</pre></table></code></div></div><h3 id="方法信息"><span class="mr-2">方法信息</span><a href="#方法信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>类中定义的静态和实例方法都称为方法，用类 Method 表示。Class 有如下相关方法：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1">// 返回所有的pub11c方法，包括其父类的，如果没有方法，返回空数组</span>
<span class="kd">public</span> <span class="nc">Method</span><span class="o">[]</span><span class="n">getMethods</span><span class="o">()</span>
<span class="c1">// 返回本类声明的所有方法，包括非pub11c的，但不包括父类的</span>
<span class="kd">public</span> <span class="nc">Method</span><span class="o">[]</span><span class="n">getDeclaredMethods</span><span class="o">()</span>
<span class="c1">// 返回本类或父类中指定名称和参数类型的publ1c方法，</span>
<span class="c1">// 找不到抛出异常NoSuchMethodException</span>
<span class="kd">public</span> <span class="nc">Method</span> <span class="nf">getMethod</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span><span class="kd">class</span><span class="err">&lt;?&gt;...</span><span class="nc">parameterTypes</span><span class="o">)</span>
<span class="c1">// 返回本类中声明的指定名你和参数类型的方法，找不到抛出异常NoSuchi№thodException</span>
<span class="kd">public</span> <span class="nc">Method</span> <span class="nf">getDeclaredMethod</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span><span class="kd">class</span><span class="err">&lt;?&gt;...</span><span class="nc">parameterTypes</span><span class="o">)</span>
</pre></table></code></div></div><p>通过 Method 可以获取方法的信息，也可以通过 Method 调用对象的方法，基本方法有：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// 获取方法的名称</span>
<span class="kd">public</span> <span class="n">string</span> <span class="nf">getName</span><span class="o">()</span>
<span class="c1">// f1ag设为true表示忽路Jawa的访问检查机制，以允许调用非oublic的方法</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAccessible</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">flag</span><span class="o">)</span>
<span class="c1">// 在指定对象obj上调用ethod代表的方法，传递的渗数列表为args</span>
<span class="kd">public</span> <span class="n">object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span><span class="n">object</span><span class="o">...</span><span class="na">args</span><span class="o">)</span><span class="kd">throws</span>
<span class="nc">IllegalAccessException</span><span class="o">,</span><span class="nc">Illegal</span><span class="o">-</span><span class="nc">ArgumentException</span><span class="o">,</span><span class="nc">InvocationTargetException</span>
</pre></table></code></div></div><p>对 invoke 方法：</p><ul><li><p>如果 Method 为静态方法，obj 被忽略，可以为 null，args 可以为null，也可以为一个空的 数组，方法调用的返回值被包装为 Objecti 返回；</p><li><p>如果实际方法调用抛出异常，异常被包装为 InvocationTargetException 重新抛出，可以通过 getCause方法得到原异常。</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span><span class="err">&lt;?&gt;</span> <span class="nc">cls</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="nc">Method</span> <span class="n">method</span> <span class="n">cls</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"parseInt"</span><span class="o">,</span><span class="k">new</span> <span class="kd">class</span><span class="err">[](</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span><span class="s">"123"</span><span class="o">));</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchMethodException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printstackTrace</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InvocationTargetException</span> <span class="n">e</span><span class="o">){</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printstackTrace</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div></ul><p>Mthode 还有很多方法，可以获取其修饰符、参数、返回值、注解等信息，具体就不列举了。</p><h3 id="创建对象和构造函数"><span class="mr-2">创建对象和构造函数</span><a href="#创建对象和构造函数" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Class 有一个方法，可以用它来创建对象：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="no">T</span> <span class="nf">newInstance</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InstantiationException</span><span class="o">,</span> <span class="nc">IllegalAccessException</span> <span class="o">{}</span>
</pre></table></code></div></div><p>这个方法会调用类的默认构造方法，如果类没有该构造方法，就会抛出 InstantialionException。</p><p>类 Constructor 表示构造方法，通过它可以创建对象，方法为：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">Constructor</span><span class="o">&lt;</span><span class="n">stringBuilder</span><span class="o">&gt;</span><span class="n">contructor</span><span class="o">-</span><span class="nc">StringBuilder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span><span class="k">new</span> <span class="kd">class</span><span class="err">[]{</span><span class="nc">int</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
<span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="n">contructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
</pre></table></code></div></div><p>除此之外，Constructor 还有很多方法，可以获取关于构造方法的很多信息，包括参数、修饰符、注解等。</p><h3 id="类型检查和转换"><span class="mr-2">类型检查和转换</span><a href="#类型检查和转换" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>instanceof 关键字，用来判断变量指向的实际对象类型。</p><p>instanceof 后面的类型是在代码中确定的，如果要检查的类型是动态的，就可以使用 Class 类中下面的方法：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>public native boolean isInstance(Object obj);
</pre></table></code></div></div><p>除了判断类型，在程序中也需要进行强制类型转换，如果是动态的就可以用下面的方法：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="no">T</span> <span class="nf">cast</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{}</span>
</pre></table></code></div></div><p>instance/cast 描述的都是对象和类之间的关系，Class 还有一个方法，可以判断 Class 之间的关系：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1">// 检查参数类型 cls 能否赋给当前 Class 类型的变量</span>
<span class="kd">public</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">isAssignnableFrom</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span><span class="o">)</span>
</pre></table></code></div></div><p>比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nc">Object</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="nc">ArrayList</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</pre></table></code></div></div><h3 id="class-类型信息"><span class="mr-2">Class 类型信息</span><a href="#class-类型信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Class 代表的类型既可以是普通类、也可以是内部类、还可以是基本类型、数组等，对于一个给定的 Class 对象，可以用下面的方法进行检查是什么类型</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">isArray</span><span class="o">();</span>		<span class="c1">// 是否是数组</span>
<span class="kd">public</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">isPrimitive</span><span class="o">();</span>	<span class="c1">// 是否是基本类型</span>
<span class="kd">public</span> <span class="kd">native</span> <span class="kt">boolean</span> <span class="nf">isInterface</span><span class="o">();</span>	<span class="c1">// 是否是接口</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEnum</span><span class="o">()</span> <span class="o">{}</span>				<span class="c1">// 是否是枚举</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAnnotation</span><span class="o">()</span> <span class="o">{}</span>		<span class="c1">// 是否是注解</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAnonymousClass</span><span class="o">()</span> <span class="o">{}</span>	<span class="c1">// 是否是匿名内部类</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isMemberClass</span><span class="o">()</span> <span class="o">{}</span>		<span class="c1">// 是否是成员类，成员类定义在方法外，不是匿名类</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isLocalClass</span><span class="o">()</span> <span class="o">{}</span>		<span class="c1">// 是否是本地类，本地类定义在方法内，不是匿名类</span>
</pre></table></code></div></div><h3 id="类的声明信息"><span class="mr-2">类的声明信息</span><a href="#类的声明信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>类的声明信息，如修饰符、父类、接口、注解等，可以通过下面的方法获取：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">//获取修饰符，返回值可通过od1fier类进行解读</span>
<span class="kd">public</span> <span class="kd">native</span> <span class="kt">int</span> <span class="nf">getModifiers</span><span class="o">()</span>
<span class="c1">//获取父类，如果为object,父类为nul1</span>
<span class="kd">public</span> <span class="kd">native</span> <span class="kd">class</span><span class="err">&lt;?</span><span class="nc">super</span> <span class="no">T</span><span class="o">&gt;</span><span class="n">getSuperclass</span><span class="o">()</span>
<span class="c1">//对于类，为自己声明实现的所有接口，对于接口，为直接扩展的接口，不包括通过父类继承的</span>
<span class="kd">public</span> <span class="kd">native</span> <span class="kd">class</span><span class="err">&lt;?&gt;[]</span><span class="nc">getInterfaces</span><span class="o">();</span>
<span class="c1">//自己声明的注解</span>
<span class="kd">public</span> <span class="nc">Annotation</span><span class="o">[]</span><span class="n">getDeclaredAnnotations</span><span class="o">()</span>
<span class="c1">//所有的注解，包括继承得到的</span>
<span class="kd">public</span> <span class="nc">Annotation</span><span class="o">[</span><span class="n">getAnnotations</span><span class="o">()</span>
<span class="c1">//获阿或检查指定类型的注解，包括继承得到的</span>
<span class="kd">public</span> <span class="o">&lt;</span><span class="no">A</span> <span class="kd">extends</span> <span class="nc">Annotation</span><span class="o">&gt;</span><span class="no">A</span> <span class="nf">getAnnotation</span><span class="o">(</span><span class="kd">class</span><span class="err">&lt;</span><span class="nc">A</span><span class="o">&gt;</span><span class="n">annotationclass</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAnnotationPresent</span><span class="o">(</span>
<span class="kd">class</span><span class="err">&lt;?</span><span class="nc">extends</span> <span class="nc">Annotation</span><span class="o">&gt;</span><span class="n">annotationclass</span><span class="o">)</span>
</pre></table></code></div></div><h3 id="类的加载"><span class="mr-2">类的加载</span><a href="#类的加载" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Class 有两个静态方法，可以根据类名加载类：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span><span class="err">&lt;?&gt;</span><span class="nc">forName</span><span class="o">(</span><span class="nc">String</span> <span class="n">className</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span><span class="err">&lt;?&gt;</span><span class="nc">forName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span><span class="kt">boolean</span> <span class="n">initialize</span><span class="o">,</span>
<span class="nc">ClassLoader</span> <span class="n">loader</span><span class="o">)</span>
</pre></table></code></div></div><p>ClassLoader 表示类加载器，initialize表示加载后，是否执行类的初始化代码 (如static语句块)。第一个方法中没有传这些参数，相当于调用：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1">// currentLoader 表示加载当前类的 ClassLoader</span>
<span class="kd">class</span><span class="err">.</span><span class="nc">forName</span><span class="o">(</span><span class="n">className</span><span class="o">,</span><span class="kc">true</span><span class="o">,</span><span class="n">currentLoader</span><span class="o">)</span>
</pre></table></code></div></div><p>这里 className 与 Class.getName 的返回值是一致的。比如，对于 String 数组：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>String name "[Ljava.lang.String;";
class cls class.forName(name);
System.out.println(cls String[].class);
</pre></table></code></div></div><p>需要注意的是，基本类型不支持 forName 方法，也就是说，<code class="language-plaintext highlighter-rouge">class.forName("int");</code>会抛出异常 ClassNotFoundException。</p><p>不过，可以对<code class="language-plaintext highlighter-rouge">Class.forName</code>进行一下包装，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span><span class="err">&lt;?&gt;</span><span class="nc">forName</span><span class="o">(</span><span class="nc">String</span> <span class="n">className</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">classNotFoundException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="s">"int"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">className</span><span class="o">)){</span>
        <span class="k">return</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// 其他基本类型路</span>
    <span class="k">return</span> <span class="kd">class</span><span class="err">.</span><span class="nc">forName</span><span class="o">(</span><span class="n">className</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Java9 还有一个 forName 方法，用于加载指定模块中指定名称的类：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">// Module 表示模块，是 Java 9 引入的类</span>
<span class="c1">// 当找不到类的时候，不会抛出异常，而是返回 null，也不会执行类的初始化</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span><span class="err">&lt;?&gt;</span> <span class="nc">forName</span><span class="o">(</span><span class="nc">Module</span> <span class="n">module</span><span class="o">,</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span>
</pre></table></code></div></div><h3 id="反射与数组"><span class="mr-2">反射与数组</span><a href="#反射与数组" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>对于数组类型，可以通过下面的方法，获取它的元素类型：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">native</span> <span class="kd">class</span><span class="err">&lt;?&gt;</span> <span class="nc">getcomponentType</span><span class="o">()</span>
</pre></table></code></div></div><p>就像：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">String</span><span class="o">[]</span><span class="n">arr</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printin</span><span class="o">(</span><span class="n">arr</span><span class="o">.</span><span class="na">getclass</span><span class="o">().</span><span class="na">getComponentType</span><span class="o">());</span>
</pre></table></code></div></div><p>输出为：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span>
</pre></table></code></div></div><p>java.lang.reflect 包中有一个针对数组的专门的类 Array(注意不是java.util中的Arrays)，提供了对于数 组的一些反射支持，以便于统一处理多种类型的数组，主要方法有：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// 创建指定元素类型、指定长度的数组</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">object</span> <span class="nf">newInstance</span><span class="o">(</span><span class="kd">class</span><span class="err">&lt;?&gt;</span><span class="nc">componentType</span><span class="o">,</span><span class="kt">int</span> <span class="n">length</span><span class="o">)</span>
<span class="c1">// 创建多维数组</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">object</span> <span class="nf">newInstance</span><span class="o">(</span><span class="kd">class</span><span class="err">&lt;?&gt;</span><span class="nc">componentType</span><span class="o">,</span><span class="kt">int</span><span class="o">...</span><span class="na">dimensions</span><span class="o">)</span>
<span class="c1">// 获取数组array指定的索引位置index处的值</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="n">object</span> <span class="nf">get</span><span class="o">(</span><span class="n">object</span> <span class="n">array</span><span class="o">,</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span>
<span class="c1">// 修改数组array指定的索位置index处的值为value</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">object</span> <span class="n">array</span><span class="o">,</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span><span class="n">object</span> <span class="n">value</span><span class="o">)</span>
<span class="c1">// 返回数组的长度</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">int</span> <span class="nf">getLength</span><span class="o">(</span><span class="n">object</span> <span class="n">array</span><span class="o">)</span>
</pre></table></code></div></div><p>不过，在 Array 类中，数组是用 Object 而非 Object[] 表示的，这是因为方便处理多种类型的数组。int0、String0 都不能与 Objectl0 相互转换，但可以与 Object 相互转换，比如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kt">int</span><span class="o">[]</span> <span class="n">intArr</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">[])</span><span class="nc">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="mi">10</span><span class="o">);</span>
<span class="nc">String</span><span class="o">[]</span> <span class="n">strArr</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">[])</span><span class="nc">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="mi">10</span><span class="o">);</span>
</pre></table></code></div></div><p>除了 Object2 类型操作数组元素外，Array 也支持以各种基本类型操作数组元素，如：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">double</span> <span class="nf">getDouble</span><span class="o">(</span><span class="nc">Object</span> <span class="n">array</span><span class="o">,</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">setDouble</span><span class="o">(</span><span class="n">object</span> <span class="n">array</span><span class="o">,</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span><span class="kt">double</span> <span class="n">d</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">setLong</span><span class="o">(</span><span class="n">object</span> <span class="n">array</span><span class="o">,</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span><span class="kt">long</span> <span class="mi">1</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">long</span> <span class="nf">getLong</span><span class="o">(</span><span class="n">object</span> <span class="n">array</span><span class="o">,</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span>
</pre></table></code></div></div><h3 id="反射与枚举"><span class="mr-2">反射与枚举</span><a href="#反射与枚举" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>通过下面的方法，获取所有的枚举常量：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">getEnumConstants</span><span class="o">()</span>
</pre></table></code></div></div><h3 id="反射与泛型"><span class="mr-2">反射与泛型</span><a href="#反射与泛型" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>泛型参数在运行时会被擦除，在类信息 CIass 中依然有关于泛型的一些信息，可以通过反射得到。</p><p>Class 有如下方法，可以获取类的泛型参数信息：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">Typevariable</span><span class="o">&lt;</span><span class="kd">class</span><span class="err">&lt;</span><span class="nc">T</span><span class="o">&gt;&gt;[]</span><span class="n">getTypeParameters</span><span class="o">()</span>
</pre></table></code></div></div><p>Field 有如下方法：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>public Type getGenericType()
</pre></table></code></div></div><p>Method 有如以下方法：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">Type</span> <span class="nf">getGenericReturnType</span><span class="o">()</span>
<span class="kd">public</span> <span class="nc">Type</span><span class="o">[]</span> <span class="nf">getGenericParameterTypes</span><span class="o">()</span>
<span class="kd">public</span> <span class="nc">Type</span><span class="o">[]</span> <span class="nf">getGenericExceptionTypes</span><span class="o">()</span>
</pre></table></code></div></div><p>Constructor 有如下方法：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>
</pre></table></code></div></div><p>Type 是一个接口，Class 实现了 Type，Type 的其他子接口还有：</p><ul><li>Type Variable：类型参数，可以有上界，比如 T extends Number;<li>ParameterizedType：参数化的类型，有原始类型和具体的类型参数，比如 List;<li>WildcardType：通配符类型，比如 ？、？extends Number、?super Integer。.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericDemo</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">GenericTest</span><span class="o">&lt;</span><span class="no">U</span> <span class="kd">extends</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="no">U</span><span class="o">&gt;,</span> <span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="no">U</span> <span class="n">u</span><span class="o">;</span>
        <span class="no">V</span> <span class="n">v</span><span class="o">;</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>
        <span class="kd">public</span> <span class="no">U</span> <span class="nf">test</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Number</span><span class="o">&gt;</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">NoSuchFieldException</span><span class="o">,</span> <span class="nc">NoSuchMethodException</span> <span class="o">{</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="nc">GenericTest</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>

        <span class="c1">// 类的类型参数</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">TypeVariable</span> <span class="n">t</span> <span class="o">:</span> <span class="n">cls</span><span class="o">.</span><span class="na">getTypeParameters</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" extends "</span> <span class="o">+</span>
                    <span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">getBounds</span><span class="o">()));</span>
        <span class="o">}</span>

        <span class="c1">// 字段：泛型类型</span>
        <span class="nc">Field</span> <span class="n">fu</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">"u"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fu</span><span class="o">.</span><span class="na">getGenericType</span><span class="o">());</span>

        <span class="c1">// 字段：参数化的类型</span>
        <span class="nc">Field</span> <span class="n">flist</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">"list"</span><span class="o">);</span>
        <span class="nc">Type</span> <span class="n">listType</span> <span class="o">=</span> <span class="n">flist</span><span class="o">.</span><span class="na">getGenericType</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">listType</span> <span class="k">instanceof</span> <span class="nc">ParameterizedType</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">ParameterizedType</span> <span class="n">pType</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ParameterizedType</span><span class="o">)</span> <span class="n">listType</span><span class="o">;</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"raw type: "</span> <span class="o">+</span> <span class="n">pType</span><span class="o">.</span><span class="na">getRawType</span><span class="o">()</span>
                    <span class="o">+</span> <span class="s">", type arguments: "</span>
                    <span class="o">+</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">pType</span><span class="o">.</span><span class="na">getActualTypeArguments</span><span class="o">()));</span>
        <span class="o">}</span>

        <span class="c1">// 方法的泛型参数</span>
        <span class="nc">Method</span> <span class="n">m</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">});</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Type</span> <span class="nl">t:</span> <span class="n">m</span><span class="o">.</span><span class="na">getGenericParameterTypes</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>输出为：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="no">U</span> <span class="kd">extends</span> <span class="o">[</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Comparable</span><span class="o">&lt;</span><span class="no">U</span><span class="o">&gt;]</span>
<span class="no">V</span> <span class="kd">extends</span> <span class="o">[</span><span class="kd">class</span> <span class="nc">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">]</span>
<span class="no">U</span>
<span class="n">raw</span> <span class="nl">type:</span> <span class="kd">interface</span> <span class="nc">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span><span class="o">,</span> <span class="n">type</span> <span class="nl">arguments:</span> <span class="o">[</span><span class="kd">class</span> <span class="nc">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">]</span>
<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span><span class="o">&gt;</span>
</pre></table></code></div></div><h2 id="应用栗子"><span class="mr-2">应用栗子</span><a href="#应用栗子" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>利用反射实现一个简单的通用序列化/反序列化类 SimpleMapper，有两个静态方法：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">// 将对象 obj 转换为字符串</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">tostring</span><span class="o">(</span><span class="n">object</span> <span class="n">obj</span><span class="o">)</span>
<span class="c1">// fromString 将字符串转换为对象    </span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">object</span> <span class="nf">fromstring</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span>
</pre></table></code></div></div><p>我只实现最简单的类，即有默认构造方法，成员类型只有基本类型、包装类或 String。另外，序列化的格式也很简单，第一行为类的名称，后面每行表示一个字段，用字符 “=” 分隔，表示<strong>字段名称</strong>和<strong>字符串形式</strong>的值。</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleMapperDemo</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Student</span><span class="o">{</span>
        <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
        <span class="nc">Double</span> <span class="n">score</span><span class="o">;</span>
        <span class="c1">// 省路构造方法，getter/setter和tostring方法</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span><span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Student</span> <span class="n">zhangsan</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Student</span><span class="o">(</span><span class="s">"张三"</span><span class="o">,</span> <span class="mi">18</span><span class="o">,</span><span class="mi">89</span><span class="n">d</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="nc">SimpleMapper</span><span class="o">.</span><span class="na">tostring</span><span class="o">(</span><span class="n">zhangsan</span><span class="o">);</span>
        <span class="nc">Student</span> <span class="n">zhangsan2</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Student</span><span class="o">)</span><span class="n">simpleMapper</span><span class="o">.</span><span class="na">fromstring</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zhangsan2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleMapper</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">tostring</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
            <span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">cls</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">Field</span> <span class="n">f</span> <span class="o">:</span> <span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">f</span><span class="o">.</span><span class="na">isAccessible</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">f</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">obj</span><span class="o">).</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>

            <span class="o">}</span>
            <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Object</span> <span class="nf">fromString</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">lines</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">lines</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
            <span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">lines</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lines</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="nc">String</span><span class="o">[]</span> <span class="n">fv</span> <span class="o">=</span> <span class="n">lines</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">split</span><span class="o">(</span><span class="s">"="</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">fv</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="n">lines</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                    <span class="o">}</span>
                    <span class="nc">Field</span> <span class="n">f</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">fv</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                    <span class="k">if</span> <span class="o">(!</span><span class="n">f</span><span class="o">.</span><span class="na">isAccessible</span><span class="o">())</span> <span class="o">{</span>
                        <span class="n">f</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="n">setFieldValue</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">obj</span><span class="o">,</span> <span class="n">fv</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setFieldValue</span><span class="o">(</span><span class="nc">Field</span> <span class="n">f</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IllegalAccessException</span><span class="o">,</span> <span class="nc">NoSuchMethodException</span><span class="o">,</span> <span class="nc">InvocationTargetException</span><span class="o">,</span> <span class="nc">InstantiationException</span> <span class="o">{</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getType</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="kt">byte</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setByte</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="nc">Byte</span><span class="o">.</span><span class="na">parseByte</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="kt">short</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setShort</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="nc">Short</span><span class="o">.</span><span class="na">parseShort</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="kt">long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="kt">float</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setFloat</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="nc">Float</span><span class="o">.</span><span class="na">parseFloat</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="kt">double</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setDouble</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="nc">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="kt">char</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setChar</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="kt">boolean</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">setBoolean</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="nc">Boolean</span><span class="o">.</span><span class="na">parseBoolean</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">f</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">ctor</span> <span class="o">=</span> <span class="n">type</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span>
                    <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">});</span>
            <span class="n">f</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">ctor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p>输出如：<code class="language-plaintext highlighter-rouge">Student [name,age-18,score-89.0]</code></p><h2 id="总结"><span class="mr-2">总结</span><a href="#总结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>反射虽然是灵活的，但一般情况下，并不是优先选择的，主要原因是：</p><ol><li>反射容易出现运行时错误，使用显式的类和接口，编译器能帮助做类型检查，减少错误，但 使用反射，类型是运行时才知道的，编译器无能为力；<li>反射的性能要低一些，在访问字段、调用方法前，反射先要查找对应的 Field/Method，要慢一些；<li>总之，如果能用接口实现同样的灵活性，就不要使用反射。</ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a>, <a href='/categories/base/'>Base</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/reflect/" class="post-tag no-text-decoration" >reflect</a> <a href="/tags/%E5%8F%8D%E5%B0%84/" class="post-tag no-text-decoration" >反射</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=反射 - ThinkerWalker&amp;url=/posts/reflect/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=反射 - ThinkerWalker&amp;u=/posts/reflect/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=/posts/reflect/&amp;text=反射 - ThinkerWalker" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/use-spring-security-to-build-a-user-authentication-system/">Spring Security 的配置体系</a><li><a href="/posts/spring-data-jpa-test/">利用单元测试和集成测试</a><li><a href="/posts/query-annotation/">Spring Data JPA - @Query</a><li><a href="/posts/defining-query-methods/">Spring Data JPA - Defining Query Methods 的命名语法与参数</a><li><a href="/posts/cache-redis-02/">Redis 的数据类型</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/jvm/">JVM</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a> <a class="post-tag" href="/tags/architecture-design/">Architecture Design</a> <a class="post-tag" href="/tags/backend-system/">Backend System</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/spring-security/">Spring Security</a> <a class="post-tag" href="/tags/springboot/">SpringBoot</a> <a class="post-tag" href="/tags/cache/">Cache</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/classloader-base/"><div class="card-body"> <em class="timeago small" data-ts="1541302440" > 2018-11-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>类加载机制</h3><div class="text-muted small"><p> 类加载器（ClassLoader）就是加载其他类的类，负责将字节码文件加载到内存，创建 Class 对象。与反射、注解和动态代理一样，在大部分的应用编程中，需要自己实现 ClassLoader。 不过，理解类加载的机制和过程，有助于更好地理解反射、注解和动态代理。比如在反射中的 Class 的静态方法 Class.forName。 ClassLoader，一般是系统提供的，不需要自己实现...</p></div></div></a></div><div class="card"> <a href="/posts/dynamic-agent/"><div class="card-body"> <em class="timeago small" data-ts="1536636840" > 2018-09-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>动态代理</h3><div class="text-muted small"><p> 动态代理，可以在运行时动态创建一个类，实现一个或多个接口。可以在不修改原有类的基础上动态为通过该类获取的对象添加方法、修改行为。 这个特性被广泛的应用于各种系统程序、框架和库中，比如 Spring、Hibernate、MyBatis、Guice 等。 动态代理是实现面向切面编程 AOP（Aspect Oriented Programming）的基础。切面的栗子有日志、性能监控、权限检查、...</p></div></div></a></div><div class="card"> <a href="/posts/annotation/"><div class="card-body"> <em class="timeago small" data-ts="1537068840" > 2018-09-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>注解</h3><div class="text-muted small"><p> 在 Java中，注解就是给程序添加一些信息，用字符@开头，这些信息用于修饰它后面紧挨着的其他代码元素，比如：类、接口、字段、方法、方法中的参数、构造方法等。注解可以被编译器、程序运行时和其他工具使用，用于增强或修改程序行为等。 内置注解 @Override Java 内置了一些常用注解：@Override、@Deprecated、@SuppressWarnings。 @Overrid...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/dynamic-agent/" class="btn btn-outline-primary" prompt="上一篇"><p>动态代理</p></a> <a href="/posts/annotation/" class="btn btn-outline-primary" prompt="下一篇"><p>注解</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/happymaya">superhsc</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/jvm/">JVM</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a> <a class="post-tag" href="/tags/architecture-design/">Architecture Design</a> <a class="post-tag" href="/tags/backend-system/">Backend System</a> <a class="post-tag" href="/tags/devops/">DevOps</a> <a class="post-tag" href="/tags/spring-security/">Spring Security</a> <a class="post-tag" href="/tags/springboot/">SpringBoot</a> <a class="post-tag" href="/tags/cache/">Cache</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
